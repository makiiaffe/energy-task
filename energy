<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>NEURAL-OS v8.0 | Trophy Road</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { 
            --bg: #030305; --panel: #0a0a0f; --accent: #00f2ff; 
            --burn: #ff2a6d; --gain: #05ffa1; --text: #d1d5db;
            --border: #1a1a24; --level: #f5ed4e; --done: #12121f;
        }
        /* THEMES UNLOCKED VIA TROPHY ROAD */
        body.lvl-3 { --accent: #ffcc00; }
        body.lvl-5 { --accent: #00ff88; }
        body.lvl-10 { --accent: #ff2a6d; --border: #3a101d; }

        * { box-sizing: border-box; transition: 0.2s cubic-bezier(0.4, 0, 0.2, 1); }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); margin: 0; display: flex; height: 100vh; overflow: hidden; }

        input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        input[type=number] { -moz-appearance: textfield; }

        .sidebar { width: 340px; background: var(--panel); border-right: 1px solid var(--border); display: flex; flex-direction: column; padding: 20px; gap: 15px; }
        .main-deck { flex-grow: 1; padding: 25px; overflow-y: auto; display: flex; flex-direction: column; gap: 20px; }
        .void-panel { width: 320px; background: var(--panel); border-left: 1px solid var(--border); display: flex; flex-direction: column; }

        .stat-card { background: #0c0c14; border: 1px solid var(--border); padding: 15px; border-radius: 12px; position: relative; }
        .xp-bar { width: 100%; height: 8px; background: #000; border-radius: 10px; margin-top: 8px; overflow: hidden; border: 1px solid #222; }
        #xp-fill { height: 100%; width: 0%; background: var(--level); box-shadow: 0 0 10px var(--level); transition: width 1s ease; }

        .task-card { background: #0d0d14; border: 1px solid var(--border); padding: 15px; border-radius: 12px; display: flex; align-items: center; gap: 15px; }
        .task-card.completed { border-color: var(--gain); opacity: 0.6; background: #05100a; }
        .check-node { width: 24px; height: 24px; border: 2px solid var(--border); border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .completed .check-node { background: var(--gain); border-color: var(--gain); color: #000; }

        .node-stepper { display: flex; align-items: center; background: #000; border-radius: 8px; border: 1px solid var(--border); padding: 2px; }
        .node-btn { background: #1a1a24; border: none; color: var(--accent); width: 25px; height: 25px; border-radius: 5px; cursor: pointer; font-weight: bold; }
        .node-btn:hover { background: var(--accent); color: #000; }
        .node-input { background: none; border: none; color: white; width: 35px; text-align: center; font-size: 12px; font-family: monospace; }

        .history-item { background: #050508; border: 1px solid var(--border); padding: 10px; border-radius: 8px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center; }
        .btn-sync { background: var(--gain); color: #000; padding: 15px; border-radius: 10px; width: 100%; font-weight: 800; cursor: pointer; border: none; margin-top: auto; }
        .trash-btn { background: none; border: none; color: var(--burn); opacity: 0.4; cursor: pointer; }

        #chat-log { flex-grow: 1; padding: 15px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; font-size: 12px; }
        .msg { background: #11111a; padding: 10px; border-radius: 8px; border-left: 2px solid var(--accent); }

        /* TROPHY ROAD TOOLTIP */
        .trophy-road-info { font-size: 9px; color: var(--accent); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 5px; }
    </style>
</head>
<body>

<div class="sidebar">
    <div class="stat-card">
        <div class="trophy-road-info" id="next-unlock">Unlock Amber at LVL 3</div>
        <h2 id="lvl-display" style="margin: 0; color: var(--level);">LVL 1</h2>
        <div class="xp-bar"><div id="xp-fill"></div></div>
        <div style="font-size: 11px; margin-top: 8px; display:flex; justify-content:space-between">
            <span>Streak: <b id="streak-val">0</b></span>
            <span>XP: <b id="xp-val">0</b></span>
        </div>
    </div>

    <div class="stat-card">
        <div style="font-size: 10px; opacity: 0.5;">CAPACITY</div>
        <div class="node-stepper" style="margin-top:10px; justify-content: space-between;">
            <button class="node-btn" onclick="stepCap(-5)">-</button>
            <input type="number" id="startME" value="50" class="node-input" onchange="save()">
            <button class="node-btn" onclick="stepCap(5)">+</button>
        </div>
    </div>

    <div style="font-size: 12px; font-weight: bold; margin-top: 10px;">CYCLE LOGS</div>
    <div id="archive-list" style="overflow-y: auto; flex-grow: 1;"></div>
    
    <button class="btn-sync" onclick="archiveDay()"><i class="fas fa-trophy"></i> SYNC & CLAIM XP</button>
</div>

<div class="main-deck">
    <div class="stat-card">
        <div style="height: 200px;"><canvas id="energyChart"></canvas></div>
        <button class="btn-sync" style="background:var(--accent); margin-top:15px;" onclick="optimize()">OPTIMIZE NEURAL LOAD</button>
    </div>

    <div id="taskList" style="display: flex; flex-direction: column; gap: 10px;"></div>

    <div class="task-card" style="border-style: dashed; background: transparent;">
        <input type="text" id="newName" placeholder="Define objective..." style="background:none; border:none; color:white; flex-grow:1; outline:none; font-family:inherit;">
        <div class="node-stepper"><input type="number" id="newCost" value="10" class="node-input"></div>
        <div class="node-stepper"><input type="number" id="newGain" value="5" class="node-input"></div>
        <button class="node-btn" style="width:40px; background:var(--accent); color:#000" onclick="addTask()">+</button>
    </div>
</div>

<div class="void-panel">
    <div style="padding:20px; border-bottom:1px solid var(--border); font-size:12px; font-weight:bold; color:var(--accent)">INTERNAL_VOICE.exe</div>
    <div id="chat-log"></div>
    <div style="padding:15px; border-top:1px solid var(--border); display:flex; gap:8px;">
        <input type="text" id="chatInput" placeholder="Analyze..." style="background:#000; border:1px solid var(--border); color:white; flex-grow:1; padding:10px; border-radius:8px; outline:none;" onkeypress="if(event.key==='Enter') sendChat()">
        <button class="node-btn" onclick="sendChat()" style="width:40px">➔</button>
    </div>
</div>

<script>
    let state = JSON.parse(localStorage.getItem('neuralOS_v8')) || {
        tasks: [], startME: 50, history: {}, xp: 0, streak: 0, chat: [], 
        xpClaims: {} // Track which dates have already paid out daily XP
    };

    let chart;

    function init() {
        const ctx = document.getElementById('energyChart').getContext('2d');
        chart = new Chart(ctx, {
            type: 'line',
            data: { labels: [], datasets: [{ label: 'ME', data: [], borderColor: '#00f2ff', tension: 0.4, fill: true, backgroundColor: 'rgba(0,242,255,0.05)', pointRadius: 2 }] },
            options: { maintainAspectRatio: false, scales: { y: { beginAtZero: true, max: 100, grid: { color: '#1a1a24' } }, x: { display: false } }, plugins: { legend: { display: false } } }
        });
        render();
    }

    function stepCap(v) { document.getElementById('startME').value = parseInt(document.getElementById('startME').value) + v; save(); }

    function addTask() {
        const name = document.getElementById('newName').value;
        if(!name) return;
        state.tasks.push({ id: Date.now(), name, cost: parseInt(document.getElementById('newCost').value) || 0, gain: parseInt(document.getElementById('newGain').value) || 0, done: false, payout: false });
        save();
        document.getElementById('newName').value = '';
    }

    function toggleTask(i) {
        const t = state.tasks[i];
        t.done = !t.done;
        if(t.done && !t.payout) { state.xp += 20; t.payout = true; }
        save();
    }

    function sendChat() {
        const input = document.getElementById('chatInput');
        if(!input.value) return;
        state.chat.push({ msg: input.value, time: new Date().toLocaleTimeString() });
        input.value = '';
        save();
    }

    function save() {
        state.startME = parseInt(document.getElementById('startME').value) || 0;
        localStorage.setItem('neuralOS_v8', JSON.stringify(state));
        render();
    }

    function render() {
        const list = document.getElementById('taskList');
        list.innerHTML = '';
        let cur = state.startME;
        let chartData = [cur];
        let labels = ['Start'];

        state.tasks.forEach((t, i) => {
            let cost = t.done ? 0 : t.cost;
            if(t.done) cur += t.gain; else cur = cur - t.cost + t.gain;
            const div = document.createElement('div');
            div.className = `task-card ${t.done ? 'completed' : ''}`;
            div.innerHTML = `<div class="check-node" onclick="toggleTask(${i})">${t.done ? '✓' : ''}</div><span style="flex-grow:1">${t.name}</span><div class="node-stepper"><input type="number" class="node-input" value="${t.cost}" onchange="state.tasks[${i}].cost=parseInt(this.value);save()"></div><div class="node-stepper" style="color:var(--gain)"><input type="number" class="node-input" value="${t.gain}" onchange="state.tasks[${i}].gain=parseInt(this.value);save()"></div><button class="trash-btn" onclick="state.tasks.splice(${i},1);save()"><i class="fas fa-trash"></i></button>`;
            list.appendChild(div);
            chartData.push(Math.min(Math.max(cur, 0), 100));
            labels.push(t.name);
        });

        chart.data.datasets[0].data = chartData;
        chart.data.labels = labels;
        chart.update();

        // PROGRESS & THEMES
        const lvl = Math.floor(state.xp / 100) + 1;
        document.body.className = lvl >= 10 ? 'lvl-10' : lvl >= 5 ? 'lvl-5' : lvl >= 3 ? 'lvl-3' : '';
        document.getElementById('lvl-display').innerText = `LVL ${lvl}`;
        document.getElementById('xp-fill').style.width = `${state.xp % 100}%`;
        document.getElementById('xp-val').innerText = state.xp;
        document.getElementById('streak-val').innerText = state.streak;

        const next = lvl < 3 ? "Amber at LVL 3" : lvl < 5 ? "Forest at LVL 5" : lvl < 10 ? "Crimson at LVL 10" : "MAX RANK ACHIEVED";
        document.getElementById('next-unlock').innerText = next;

        document.getElementById('chat-log').innerHTML = state.chat.slice(-6).map(m => `<div class="msg"><b>${m.time}</b><br>${m.msg}</div>`).join('');
        const arc = document.getElementById('archive-list');
        arc.innerHTML = Object.keys(state.history).reverse().map(date => `<div class="history-item"><div style="font-size:10px;"><b>${date}</b><br><span style="color:${state.history[date].success ? 'var(--gain)' : 'var(--burn)'}">${state.history[date].success ? '✓' : '✗'}</span></div><button class="trash-btn" onclick="deleteHistory('${date}')"><i class="fas fa-trash"></i></button></div>`).join('');
    }

    function deleteHistory(d) { if(confirm("Delete cycle?")) { delete state.history[d]; save(); } }

    function optimize() {
        const undone = state.tasks.filter(t => !t.done).sort((a,b) => b.cost - a.cost);
        const done = state.tasks.filter(t => t.done);
        const best = findPath(state.startME, undone);
        if(best) { state.tasks = [...done, ...best]; save(); }
        else alert("No survivable path found.");
    }

    function findPath(me, tasks, path = []) {
        if (tasks.length === 0) return path;
        for (let i = 0; i < tasks.length; i++) {
            if (me >= tasks[i].cost) {
                const res = findPath(me - tasks[i].cost + tasks[i].gain, [...tasks.slice(0,i), ...tasks.slice(i+1)], [...path, tasks[i]]);
                if (res) return res;
            }
        }
        return null;
    }

    function archiveDay() {
        const today = new Date().toDateString();
        const success = state.tasks.length > 0 && state.tasks.every(t => t.done);
        
        // PREVENT XP FARMING: Only award "Daily Success XP" once per date
        if (!state.xpClaims[today] && success) {
            state.xp += 100;
            state.xpClaims[today] = true;
            state.streak++;
        } else if (!success) {
            state.streak = 0;
        }

        state.history[today] = { success, date: today };
        state.tasks = [];
        state.chat = [];
        save();
    }

    init();
</script>
</body>
</html>
